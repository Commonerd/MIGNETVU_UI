self.onmessage=function(e){let{type:t,payload:a}=e.data;if("FILTER_NETWORKS"===t){self.postMessage({type:"PROGRESS",payload:0});let e=function(e,t,a,i){let n=e.length,s=[];return self.postMessage({type:"PROGRESS",payload:0}),e.forEach((e,l)=>{let r=t.nationality.includes("all")||t.nationality.includes(e.nationality)||"all"===t.nationality||e.nationality===t.nationality,o=t.ethnicity.includes("all")||t.ethnicity.includes(e.ethnicity)||"all"===t.ethnicity||e.ethnicity===t.ethnicity,y=e.migration_year>=t.yearRange[0]&&e.migration_year<=t.yearRange[1],g=!t.migrationYearRange||2!==t.migrationYearRange.length||e.migration_traces.some(e=>e.migration_year>=t.migrationYearRange[0]&&e.migration_year<=t.migrationYearRange[1]),d=!t.userNetworkFilter||!i||e.user_name===i,p=!a||e.edges.some(e=>e.targetId===a),c="all"===t.entityType||(Array.isArray(t.entityType)?t.entityType.includes("all")||t.entityType.includes(e.type):e.type===t.entityType),R=!0;t.edgeType&&t.edgeType.length>0&&!t.edgeType.includes("all")&&(R=e.edges.some(e=>Array.isArray(t.edgeType)?t.edgeType.includes(e.edgeType):t.edgeType===e.edgeType));let T=t.migrationReasons.includes("all")||0===t.migrationReasons.length||e.migration_traces.some(e=>t.migrationReasons.includes(e.reason)),u=!t.selectedMigrationNetworkIds||0===t.selectedMigrationNetworkIds.length||t.selectedMigrationNetworkIds.includes(e.id);if(r&&o&&y&&g&&d&&p&&c&&T&&u&&R&&s.push(e),l%Math.ceil(n/20)==0||l===n-1){let e=Math.round((l+1)/n*100);self.postMessage({type:"PROGRESS",payload:e})}}),s}(a.networks,a.filters,a.selectedEdgeId,a.userName);self.postMessage({type:"FILTERED_NETWORKS",payload:e}),self.postMessage({type:"PROGRESS",payload:100})}if("CALCULATE_CENTRALITY"===t){let{filteredNetworks:e,centralityType:t}=a,i=function(e,t){let a={};return"degree"===t?e.forEach(e=>{a[e.id]=e.edges.length}):"none"===t&&e.forEach(e=>{a[e.id]=1}),a}(e,t);self.postMessage({type:"CENTRALITY_RESULT",payload:i})}},_N_E={};